from flask import render_template, Flask, flash, redirect, url_for
from forms.file_form import FileForm
from function.predict import predict
import os

app = Flask(__name__)
app.secret_key = '2021'

upload_dir = os.path.join(
    app.instance_path, 'upload' 
)
if not os.path.exists(upload_dir):
    os.makedirs(upload_dir, mode=0o755)

@app.route('/', methods=['GET', 'POST'])
def index():
    form = FileForm()
    if form.validate_on_submit():
        f = form.file_path.data
        fp = os.path.join(upload_dir, f.filename)
        f.save(fp)
        flash('Upload success')
        return redirect(url_for('result',file_path='hh'))
    return render_template('index.html', form=form)

@app.route('/result/?<path:file_path>', methods=['GET', 'POST'])
def result(file_path):
    result = predict(file_path)
    return render_template('result.html', result=result)

if __name__ == '__main__':
    app.run()