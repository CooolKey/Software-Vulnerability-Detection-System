from applescript import tell
import applescript
import subprocess
import time
import os

def extract(file_path,dst_path):
    mac = "caokeyi@192.168.1.30"
    ubuntu = "key@192.168.1.43"
    path = "/home/key/Desktop/test"
    result = "/home/key/.cuckoo/storage/analyses/1/reports/report.json"
    name = os.path.basename(file_path)

    y = "y\n"
    # appscript.app('Terminal').do_script(y)
    # subprocess.call(["", "ls"])
    # tell.app( 'Terminal', 'do script "' + y + 'ls"')

    put = "scp " + file_path + " " + ubuntu + ":" + path + "\n"
    ssh = "ssh " + ubuntu + "\n"
    act = ". venv/bin/activate\n"
    clean = "cuckoo clean\n"
    start = "cuckoo -d\n"
    command = y + put + ssh + act + clean + start
    a = tell.app( 'Terminal', 'do script "' + command + '"')
    
    # put = ["scp", file_path, ubuntu + ":" + path]
    # ssh = ["ssh", ubuntu]
    # act = [".", "venv/bin/activate"]
    # clean = ["cuckoo", "clean"]
    # start = ["cuckoo", "-d"]
    # subprocess.call(put)
    # subprocess.call(ssh)
    # subprocess.call(act)
    
    time.sleep(10)

    ssh = "ssh " + ubuntu + "\n"
    act = ". venv/bin/activate\n"
    cuckoo = "cuckoo submit " + path + "/" + name + "\n"
    command = y + ssh + act + cuckoo

    b = tell.app( 'Terminal', 'do script "' + command + '"')
    time.sleep(120)

    get = "scp " + ubuntu + ":" + result + " " + dst_path + "\n"
    command = y + get

    c = tell.app( 'Terminal', 'do script "' + command + '"')

    return result

if __name__ == "__main__":
    file_path = "/Users/caokeyi/Desktop/PIC/WechatIMG142.jpeg"
    dst_path = "/Users/caokeyi/Desktop/beshe/Software_Vulnerability_Detection_System/system/instance/result/unknow"
    
    extract(file_path,dst_path)